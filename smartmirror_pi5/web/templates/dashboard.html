<!doctype html>
<html>

<head>
  <meta charset="utf-8" />
  <title>Smart Mirror</title>
  <meta http-equiv="refresh" content="20">
  <link rel="stylesheet" href="/static/style.css">
  <script defer src="/static/app.js"></script>
</head>

<body>
  <div class="top">
    <div class="title">Smart Mirror Â· {{ now }}</div>
  </div>

  <div class="grid">


    <!-- 1.5) ë„ì°©ì‹œê°„ ê¸°ë°˜ êµí†µìˆ˜ë‹¨ í™•ë¥  -->
    <div class="card" id="commute-prob-card">
      <div class="card-title">ğŸš¦ ë„ì°©ì‹œê°„ ê¸°ì¤€ í™•ë¥ </div>

      <div class="prob-input-row">
        <label>ë„ì°© ì‹œê°„:</label>
        <input id="arriveTime" type="time" value="09:00" class="time-input" />
      </div>

      <div class="prob-input-row">
        <label>ëª©ì ì§€:</label>
        <div class="search-container" id="destSearchContainer2">
          <input id="destInput2" class="dest-input" placeholder="ëª©ì ì§€ ì…ë ¥(ì˜ˆ: ë¶€ì‚°ì—­)" oninput="onDestinationInput2()"
            autocomplete="off" />
          <div id="placeDropdown2" class="place-dropdown"></div>
        </div>
      </div>

      <button class="btn" onclick="calcCommuteProb()">í™•ë¥  ê³„ì‚°</button>

      <div id="probResult" class="prob-result">
        ëª©ì ì§€ì™€ ë„ì°© ì‹œê°„ì„ ì…ë ¥í•˜ê³  ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.
      </div>

      <!-- ì„ íƒëœ ëª©ì ì§€ ì¢Œí‘œ ì €ì¥ -->
      <input type="hidden" id="destLat2" />
      <input type="hidden" id="destLon2" />
      <input type="hidden" id="destName2" />
    </div>

    <!-- 2) ë‚ ì”¨ -->
    <div class="card" id="weather-card">
      <div class="card-title">ğŸŒ¤ï¸ ë‚ ì”¨</div>
      <div class="weather-main">
        <div class="big">
          {% if weather.temp is not none %}{{ weather.temp|round(0) }}Â°C{% else %}--{% endif %}
        </div>
        <div class="weather-desc">{{ weather.weather_desc if weather.weather_desc else "" }}</div>
      </div>

      <!-- ë¹„/ëˆˆ ì•Œë¦¼ -->
      {% if weather.is_rain or weather.is_snow %}
      <div class="weather-alert {% if weather.is_snow %}snow{% else %}rain{% endif %}">
        {% if weather.is_snow %}
        â„ï¸ ëˆˆì´ ì˜¤ê³  ìˆìŠµë‹ˆë‹¤{% if weather.snow_1h %} ({{ weather.snow_1h }}mm/h){% endif %}
        {% else %}
        ğŸŒ§ï¸ ë¹„ê°€ ì˜¤ê³  ìˆìŠµë‹ˆë‹¤{% if weather.rain_1h %} ({{ weather.rain_1h }}mm/h){% endif %}
        {% endif %}
      </div>
      {% endif %}

      <div class="weather-details">
        <div class="sub">ì²´ê° {{ weather.feels_like|round(0) if weather.feels_like is not none else "--" }}Â°C</div>
        <div class="sub">ê°•ìˆ˜í™•ë¥  {{ (precip_prob*100)|round(0) }}%</div>
        {% if weather.humidity is not none %}<div class="sub">ìŠµë„ {{ weather.humidity }}%</div>{% endif %}
      </div>

      <!-- ë‚ ì”¨ ê¸°ë°˜ ë¸Œë¦¬í•‘ -->
      {% if briefing.action_points %}
      <div class="weather-briefing">
        {% for p in briefing.action_points %}
        <div class="briefing-point">{{ p }}</div>
        {% endfor %}
      </div>
      {% endif %}
    </div>

    <!-- 3) ë²„ìŠ¤ + ì •ë¥˜ì¥ ê²€ìƒ‰ (í†µí•©) -->
    <div class="card" id="bus-card">
      <div class="card-title">ğŸšŒ ë²„ìŠ¤ Â· ì •ë¥˜ì¥</div>

      <!-- í˜„ì¬ ì •ë¥˜ì¥ ì •ë³´ -->
      <div id="busInfo">
        <div class="bus-stop-header">
          <span class="stop-label">ì •ë¥˜ì¥:</span>
          <span class="stop-name" id="currentStopName">{{ stop.nodeNm if stop else "ì •ë¥˜ì¥ ì—†ìŒ" }}{% if stop and stop.nodeNo
            %} (#{{ stop.nodeNo }}){% endif %}</span>
        </div>
        {% if stop %}
        <div class="bus-main">
          <div class="big" id="currentETA">{{ eta_min if eta_min is not none else "--" }}ë¶„</div>
          <div class="sub eta-label">ë‹¤ìŒ ë²„ìŠ¤ê¹Œì§€</div>
        </div>
        <div class="list" id="busArrivals">
          {% for a in arrivals_preview %}
          <div class="row bus-row">
            <div class="left">
              <span class="bus-no">{{ a.routeNo }}</span>
              {% if a.endNodeNm %}<span class="bus-direction">â†’{{ a.endNodeNm }}</span>{% endif %}
            </div>
            <div class="right">{{ a.arrTimeMin if a.arrTimeMin is not none else "--" }}ë¶„</div>
          </div>
          {% endfor %}
        </div>
        {% else %}
        <div class="bus-main">
          <div class="big" id="currentETA">--</div>
          <div class="sub">ì •ë¥˜ì¥ ì •ë³´ ì—†ìŒ</div>
        </div>
        <div class="list" id="busArrivals"></div>
        {% endif %}
      </div>

      <!-- ê²€ìƒ‰ ì˜ì—­ -->
      <div class="search-area">
        <div class="search-row">
          <div class="search-container" id="busSearchContainer">
            <input type="text" id="busStopInput" placeholder="ë‹¤ë¥¸ ì •ë¥˜ì¥ ê²€ìƒ‰..." class="dest-input"
              oninput="onBusStopInput()">
            <div id="busStopDropdown" class="place-dropdown"></div>
          </div>
        </div>
        <div id="busStatus" class="sub status-text"></div>
      </div>
    </div>

    <!-- 4) ì§€í•˜ì²  -->
    <div class="card" id="subway-card">
      <div class="card-title">ğŸš‡ ì§€í•˜ì² </div>

      <div id="subwayInfo">
        <!-- ì—­ ì •ë³´ & ìš”ì¼ -->
        <div class="subway-header">
          <div class="stop-name" id="currentSubwayStation">ì—­ ì •ë³´ ì—†ìŒ</div>
          <div class="day-type" id="subwayDayType">í‰ì¼</div>
        </div>

        <!-- ë©”ì¸ ETA í‘œì‹œ -->
        <div class="subway-main">
          <div class="big" id="subwayNextETA">--</div>
          <div class="sub eta-label">ë‹¤ìŒ ì—´ì°¨ê¹Œì§€</div>
        </div>

        <!-- ìƒí–‰/í•˜í–‰ ì‹œê°„í‘œ ë¯¸ë¦¬ë³´ê¸° -->
        <div class="subway-tracks">
          <!-- ìƒí–‰ (ë˜ëŠ” ë‚´ì„ ) -->
          <div class="track-col">
            <div class="track-title">ìƒí–‰/ë‚´ì„ </div>
            <div class="list" id="subwayUpList">
              <div class="sub">--</div>
            </div>
          </div>
          <!-- í•˜í–‰ (ë˜ëŠ” ì™¸ì„ ) -->
          <div class="track-col">
            <div class="track-title">í•˜í–‰/ì™¸ì„ </div>
            <div class="list" id="subwayDownList">
              <div class="sub">--</div>
            </div>
          </div>
        </div>

        <!-- ê²€ìƒ‰ ì˜ì—­ -->
        <div class="search-area" id="subwaySearchContainer">
          <div class="search-row">
            <input type="text" id="subwayInput" placeholder="ì§€í•˜ì² ì—­ ê²€ìƒ‰..." oninput="onSubwayInput()" autocomplete="off">
          </div>
          <div id="subwayDropdown" class="dropdown-list"></div>
        </div>
      </div>
    </div>

    <!-- 4) íƒì‹œ + ëª©ì ì§€ ê²€ìƒ‰ (í†µí•©) -->
    <div class="card" id="taxi-card">
      <div class="card-title">ğŸš• íƒì‹œ Â· ëª©ì ì§€</div>

      <!-- í˜„ì¬ ëª©ì ì§€ ì •ë³´ -->
      <div id="taxiInfo">
        <div class="taxi-destination">
          <span class="dest-label">ëª©ì ì§€:</span>
          <span class="dest-name" id="currentDestName">{{ dest_name }}</span>
        </div>
        {% if taxi.ok %}
        <div class="taxi-main">
          <div class="big" id="currentDuration">{{ taxi.duration_min }}ë¶„</div>
          <div class="taxi-details">
            <div class="sub" id="currentFare">ğŸ’° {{ "{:,}".format(taxi.taxi_fare) }}ì›</div>
            <div class="sub" id="currentDistance">ğŸ“ {{ (taxi.distance_meter / 1000)|round(1) }}km</div>
          </div>
        </div>
        {% else %}
        <div class="taxi-main">
          <div class="big" id="currentDuration">--</div>
          <div class="sub" id="currentFare">{{ taxi.error if taxi.error else "ì •ë³´ ì—†ìŒ" }}</div>
        </div>
        {% endif %}
      </div>

      <!-- ê²€ìƒ‰ ì˜ì—­ -->
      <div class="search-area">
        <div class="search-row">
          <button class="btn voice-btn" id="voiceBtn" onclick="startVoiceSearch()">ğŸ™ï¸</button>
          <div class="search-container">
            <input type="text" id="destInput" placeholder="ë‹¤ë¥¸ ëª©ì ì§€ ê²€ìƒ‰..." class="dest-input"
              oninput="onDestinationInput()">
            <div id="placeDropdown" class="place-dropdown"></div>
          </div>
        </div>
        <div id="voiceStatus" class="sub status-text"></div>
      </div>
    </div>

  </div>
</body>

</html>